#!/bin/bash

set -e
if [ ! -e /.initialized_user ]; then
        # User are to be added here
        # USERNAME PASSWORD VOL_NAME VOL_ROOT [VOL_SIZE_MB]
$ANSIBLE_VAULT;1.1;AES256
64316435373939353039356266633763333535633236663662333565613331663364613435353834
6630646566616531383239623966613835323462653334350a666161613866623132356363633533
39393236626136373466656163383333656636386266326563663632353465396332393439636335
6138376636313933370a633566366536353036666530633965393535393638396435613233316336
31616232333463656162336666366434356531396634363165303564633839343534663431613766
63336131343666383661666564336332646139373066373535656261343137313363376666333736
61323761623030383638393664346133306334613935353663633432623933303064626434653362
33313035613361633039646236336538333761616633376162613335643939316132333164333638
33623535303436653033653336313063383266633338323165336639666432393631613161313331
62353537623165633762656564393739333361323962383737303563316631366165303165343532
34613565623133633835313832353465663531633538323239613837353763343530613065353538
63336430386335346632
        touch /.initialized_user
fi

if [ ! -e /.initialized_user ] && [ ! -z "$AFP_LOGIN" ] && [ ! -z "$AFP_PASSWORD" ] && [ ! -z "$AFP_NAME" ] && [ ! -z $PUID ] && [ ! -z $PGID ]; then
    add-account -i $PUID -g $PGID "$AFP_LOGIN" "$AFP_PASSWORD" "$AFP_NAME" /timemachine $AFP_SIZE_LIMIT
    touch /.initialized_user
fi

/usr/bin/supervisord -c /etc/supervisor/conf.d/supervisord.conf
